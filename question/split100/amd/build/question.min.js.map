{"version":3,"sources":["../src/question.js"],"names":["define","Question","$","Strings","FormParse","Editor","sumToIndex","array","index","reduce","a","b","i","displayToReal","display","n","m","realToDisplay","real","fixDisplayValues","percents","fixFirst","fixed","map","v","Math","round","sum","difference","mapped","corrector","sort","fixa","indexOf","fixb","abs","Split100Question","container","teameval","contextid","self","editable","optional","questionID","context","apply","arguments","pluginName","find","length","updateView","initialiseSubmissionView","window","on","bind","prototype","Object","create","sizes","showOverflow","overflow","children","eq","split","show","middle","position","left","width","contentSize","order","allowed","push","removeClass","css","direction","addClass","movingIndices","users","parseFloat","pct","split100","max","realValues","realSum","displayValues","splits","handles","partialSum","size","end","html","get","scrollWidth","clientWidth","scrollHeight","clientHeight","hide","moving","offset","movingIndex","trackingTouch","TouchEvent","evt","preventDefault","target","delegateTarget","originalEvent","touches","identifier","pageX","touch","changedTouches","leftSum","shift","leftIndex","rightIndex","submissionView","done","submissionContext","editingView","formdata","title","description","format","text","editForm","param","save","ordinal","form","saveAll","data","serializeObject","strs","key","component","valuePromise","get_strings","then","s","pcts","widths","lefts","name","id","rounded","first","savePromise","saveForm","when","submit","call","user","teamevalid","questionid","methodname","args","reset","Deferred","resolve","promise"],"mappings":"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","sourcesContent":["/* jshint shadow: true */\ndefine(['local_teameval/question', 'jquery', 'core/str', 'local_teameval/formparse', 'local_teameval/editor'],\n    function(Question, $, Strings, FormParse, Editor) {\n\n    // 5% width = 0% score\n    var MIN_SIZE = 5;\n\n    // ---- Convenience functions\n\n    function sumToIndex(array, index) {\n        return array.reduce(function(a, b, i) {\n            if (i >= index) {\n                return a;\n            }\n            return a + b;\n        }, 0);\n    }\n\n    function displayToReal (display, n) {\n        var m = 100 / (100 - MIN_SIZE * n);\n        return m * display - (MIN_SIZE * m);\n    }\n\n    function realToDisplay (real, n) {\n        var m = 100 / (100 - MIN_SIZE * n);\n        return (real + MIN_SIZE * m) / m;\n    }\n\n    // percents MUST sum to exactly 100\n    // fixFirst is an array of indices that should be adjusted first\n    // namely when a user is dragging a handle, they don't expect other\n    // segments to change value\n    function fixDisplayValues(percents, fixFirst) {\n        var fixed = percents.map(function(v) {\n            return Math.round(v);\n        });\n\n        fixFirst = fixFirst || [];\n\n        var sum = sumToIndex(fixed);\n\n        if (sum != 100) {\n\n            var difference = sum - 100;\n\n            var mapped = percents.map(function(v, i) {\n                return {i: i, v: v};\n            });\n\n            var corrector = (difference < 0) ? 1 : -1;\n            // sort by the difference between the actual values and the corrected fixed values\n            // we want the numbers which will be made *more* accurate by correcting them\n            mapped.sort(function(a, b) {\n                var fixa = fixFirst.indexOf(a.i) != -1;\n                var fixb = fixFirst.indexOf(b.i) != -1;\n                if (fixa != fixb) {\n                    return fixa ? -1 : 1;\n                }\n                return Math.abs(fixed[a.i] + corrector - a.v) - Math.abs(fixed[b.i] + corrector - b.v);\n            });\n\n            // by definition, |difference| < percents.length\n            // as difference is the sum of the fractional parts\n            for(var i = 0; i < Math.abs(difference); i++) {\n                var index = mapped[i].i;\n                fixed[index] += corrector;\n            }\n        }\n\n        return fixed;\n    }\n\n    // ----- Class definition\n\n    function Split100Question(container, teameval, contextid, self, editable, optional, questionID, context) {\n        Question.apply(this, arguments);\n        this.self = self;\n        this.context = context || {};\n        this.pluginName = \"split100\";\n\n        if (this.container.find('.hundred').length) {\n            // we've already got submission contents, initialise it\n            this.updateView();\n            this.initialiseSubmissionView();\n        }\n\n        $(window).on('resize', function() {\n            this.updateView();\n        }.bind(this));\n    }\n\n    Split100Question.prototype = Object.create(Question.prototype);\n\n    Split100Question.prototype.displayToReal = function(display) {\n        return displayToReal(display, this.sizes.length);\n    };\n\n    Split100Question.prototype.realToDisplay = function(real) {\n        return realToDisplay(real, this.sizes.length);\n    };\n\n    Split100Question.prototype.showOverflow = function(index) {\n        var overflow = this.container.find('.overflows').children('.name').eq(index);\n        var split = this.container.find('.hundred').children('.split').eq(index);\n\n        overflow.show();\n\n        var middle = split.position().left + split.width() / 2;\n        var contentSize = overflow.find('span').width() + 20;\n        var width = this.container.find('.hundred').width();\n\n        // figure out which hook we need to show\n        // if neither work, we go with the top hook (which needs its own positioning code)\n\n        var order = (middle < (width / 2)) ? ['left', 'right'] : ['right', 'left'];\n        var allowed = [];\n        if (middle + contentSize < width) {\n            allowed.push('left');\n        }\n        if (middle - contentSize > 0) {\n            allowed.push('right');\n        }\n\n        overflow.removeClass('left right middle');\n        overflow.css('margin-left', '');\n        overflow.css('margin-right', '');\n\n        for(var i = 0; i < order.length; i++) {\n            var direction = order[i];\n            if(allowed.indexOf(direction) !== -1) {\n                overflow.addClass(direction);\n\n                overflow.css('z-index', 100-index);\n\n                switch(direction) {\n                case 'left':\n                    overflow.css('left', middle - 10 + 'px');\n                    break;\n                case 'right':\n                    overflow.css('right', (width - middle) + 'px');\n                    break;\n                }\n\n                break;\n            }\n        }\n    };\n\n    Split100Question.prototype.updateView = function(movingIndices) {\n\n        if (!this.context) {\n            // no context? can't display.\n            return;\n        }\n\n        var n = this.context.users.length;\n\n        if (!this.sizes) {\n            this.sizes = this.context.users.map(function(v) {\n                return realToDisplay(parseFloat(v.pct), n);\n            }, this);\n        }\n\n        var split100 = this.container.find('.hundred');\n\n        if (split100.length === 0) {\n            // we're in the editing view or some other weird thing has happened. bail.\n            return;\n        }\n\n        // fix the sizes first\n        this.sizes = this.sizes.map(function(v) {\n            return Math.max(v, MIN_SIZE);\n        });\n\n        var sum = sumToIndex(this.sizes);\n        var realValues = this.sizes.map(this.displayToReal, this);\n        if (sum != 100) {\n            var realSum = sumToIndex(realValues);\n            var scale = 100 / realSum;\n            realValues = realValues.map(function (v) {\n                 return v * scale;\n            });\n            this.sizes = realValues.map(this.realToDisplay, this);\n        }\n\n        var displayValues = fixDisplayValues(realValues, movingIndices);\n\n        var splits = split100.children('.split');\n        var handles = split100.children('.handle');\n        var partialSum = 0;\n        for(var i = 0; i < this.sizes.length; i++) {\n            var size = this.sizes[i];\n            splits.eq(i).css({\n                width: size + '%',\n                left: partialSum + '%',\n            })\n                .find('.name')\n                    .show().end()\n                .find('.value')\n                    .html(displayValues[i] + '%');\n            partialSum += size;\n            handles.eq(i).css('left', partialSum + '%');\n\n            var split = splits.get(i);\n\n            if ((split.scrollWidth > split.clientWidth)\n                    || (split.scrollHeight > split.clientHeight)) {\n                $(split).find('.split-label .name').hide();\n                this.showOverflow(i);\n            } else {\n                this.container.find('.overflows').children('.name').eq(i).hide();\n            }\n        }\n\n    };\n\n    Split100Question.prototype.initialiseSubmissionView = function() {\n        var moving;\n        var offset;\n        var width;\n        var movingIndex;\n        var trackingTouch;\n\n        var split100 = this.container.find('.hundred');\n\n        if (window.TouchEvent) {\n            this.container.find('.handle').addClass('touch');\n        }\n\n        split100.on('mousedown touchstart', '.handle', function(evt) {\n            if (!moving) {\n                evt.preventDefault();\n\n                moving = $(evt.target);\n                movingIndex = $(evt.delegateTarget).children('.handle').index(moving);\n                offset = $(evt.delegateTarget).offset();\n                width = $(evt.delegateTarget).width();\n\n                if (evt.originalEvent.touches) {\n                    trackingTouch = evt.originalEvent.touches[0].identifier;\n                }\n\n                if (movingIndex == -1) {\n                    throw \"The DOM tree is messed up; reload the page\";\n                }\n            }\n        })\n        .on('mousemove touchmove', function(evt) {\n            if (moving) {\n                evt.preventDefault();\n\n                var pageX;\n                if (evt.pageX) {\n                    pageX = evt.pageX;\n                } else if (evt.originalEvent.touches) {\n                    for (var i = 0; i < evt.originalEvent.changedTouches.length; i++) {\n                        var touch = evt.originalEvent.changedTouches[i];\n                        if (touch.identifier == trackingTouch) {\n                            pageX = touch.pageX;\n                        }\n                    }\n                }\n\n                if (pageX === undefined) {\n                    // got an invalid or unrelated event. do nothing.\n                    return;\n                }\n\n                var target = ((pageX - offset.left) / width) * 100;\n\n                var leftSum = sumToIndex(this.sizes, movingIndex + 1);\n\n                var shift = target - leftSum;\n\n                var leftIndex = movingIndex;\n                var rightIndex = movingIndex + 1;\n\n                // Handle the case where you need to move \"through\" a zero-percent split\n                if (shift < 0) {\n                    leftIndex = null;\n                    for (var i = movingIndex; i >= 0; i--) {\n                        if (this.sizes[i] > MIN_SIZE) {\n                            leftIndex = i;\n                            break;\n                        }\n                    }\n                }\n\n                if (shift > 0) {\n                    rightIndex = null;\n                    for (var i = movingIndex + 1; i < this.sizes.length; i++) {\n                        if (this.sizes[i] > MIN_SIZE) {\n                            rightIndex = i;\n                            break;\n                        }\n                    }\n                }\n\n                // If either index is not defined, we're pushing up against the end of the bar\n                if ((leftIndex !== null) && (rightIndex !== null)) {\n                    this.sizes[leftIndex] += shift;\n                     this.sizes[rightIndex] -= shift;\n                }\n\n                this.updateView([leftIndex, rightIndex]);\n            }\n        }.bind(this))\n        .on('mouseup mouseleave touchend touchcancel', function(evt) {\n            evt.preventDefault();\n            moving = null;\n            split100.children('.split').css('color', '');\n        });\n\n    };\n\n    Split100Question.prototype.submissionView = function() {\n        return Question.prototype.submissionView.apply(this, arguments).done(function() {\n            this.updateView();\n            this.initialiseSubmissionView();\n        }.bind(this));\n    };\n\n    Split100Question.prototype.submissionContext = function() {\n        return this.context;\n    };\n\n    Split100Question.prototype.editingView = function() {\n        var formdata = {\n            title: this.context.title,\n            description: {\n                format: 1,\n                text: this.context.description\n            }\n        };\n        return this.editForm('\\\\teamevalquestion_split100\\\\forms\\\\edit_form', $.param(formdata), {});\n    };\n\n    Split100Question.prototype.save = function(ordinal) {\n        var form = this.container.find('form');\n        Editor.saveAll(form);\n\n        var data = FormParse.serializeObject(form);\n        this.context.title = data.title;\n        this.context.description = data.description.text;\n\n        var strs = [this.self ? 'yourself' : 'exampleuser', 'exampleuser', 'exampleuser', 'exampleuser'].map(function(v, i) {\n            return {key: v, component: 'teamevalquestion_split100', param: this.self ? i : i + 1};\n        }, this);\n\n        var valuePromise = Strings.get_strings(strs).then(function(s) {\n            var pcts = [20, 10, 15, 55];\n            var widths = [21, 13, 17, 49];\n            var lefts = [0, 21, 34, 51];\n            this.context.users = s.map(function(v, i) {\n                return {\n                    name: v,\n                    id: -i,\n                    pct: pcts[i],\n                    width: widths[i],\n                    left: lefts[i],\n                    rounded: pcts[i],\n                    first: (i === 0),\n                    self: (this.self ? i === 0 : false)\n                };\n            }.bind(this));\n        }.bind(this));\n\n        var savePromise = this.saveForm(form, ordinal);\n\n        return $.when(savePromise, valuePromise);\n    };\n\n    Split100Question.prototype.submit = function(call) {\n        if (!this.sizes) {\n            // we've never moved the sliders, so don't bother sending anything\n            call();\n            return true;\n        }\n\n        var percents = [];\n        for (var i = this.context.users.length - 1; i >= 0; i--) {\n            var user = this.context.users[i];\n            var size = this.sizes[i];\n            user.pct = this.displayToReal(size);\n            percents.push({'userid': user.id, 'pct': user.pct});\n        }\n\n        var data = {\n            teamevalid: this.teameval,\n            questionid: this.questionID,\n            percents: percents\n        };\n\n        call({\n            methodname: 'teamevalquestion_split100_submit_response',\n            args: data\n        });\n\n        return true;\n    };\n\n    Split100Question.prototype.reset = function() {\n        var pct = 100.0 / this.context.users.length;\n        for (var i = this.context.users.length - 1; i >= 0; i--) {\n            var user = this.context.users[i];\n            user.pct = pct;\n        }\n        this.sizes = undefined;\n        this.updateView();\n        return $.Deferred().resolve().promise();\n    };\n\n    return Split100Question;\n\n});"],"file":"question.min.js"}