{"version":3,"sources":["../src/question.js"],"names":["define","$","Question","Templates","Notification","Strings","Formparse","Editor","CommentQuestion","container","teameval","contextid","self","editing","optional","questionID","context","apply","arguments","_self","_editing","_editingcontext","editingcontext","_newquestion","_editinglocked","editinglocked","_submissioncontext","submissioncontext","pluginName","prototype","submissionContext","submissionView","editingContext","editingView","editForm","param","save","ordinal","form","find","saveAll","data","serializeObject","savePromise","saveForm","strPromise","get_strings","key","component","when","then","result","str","demoUsers","userid","name","unshift","extend","fixCheckboxes","users","description","text","bind","validateData","deferred","Deferred","v","val","trim","length","get_string","done","reject","invalid","errors","title","resolve","promise","submit","call","comments","each","toUser","m","touser","comment","push","methodname","args","teamevalid","id","incomplete","checkComplete","reset","filter","parent","addClass","removeClass"],"mappings":"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","sourcesContent":["define(['jquery', 'local_teameval/question', 'core/templates', 'core/notification',\n    'core/str', 'local_teameval/formparse', 'local_teameval/editor'],\n    function($, Question, Templates, Notification, Strings, Formparse, Editor) {\n\n    function CommentQuestion(container, teameval, contextid, self, editing, optional, questionID, context) {\n        Question.apply(this, arguments);\n\n        this._self = self;\n        this._editing = editing;\n\n        context = context || {};\n        this._editingcontext = context.editingcontext || {_newquestion: true};\n        this._editinglocked = context.editinglocked || false;\n        this._submissioncontext = context.submissioncontext || {};\n\n        this.pluginName = 'comment';\n    }\n\n    CommentQuestion.prototype = new Question();\n\n    CommentQuestion.prototype.submissionContext = function() { return this._submissioncontext; };\n\n    CommentQuestion.prototype.submissionView = function() {\n        return Question.prototype.submissionView.apply(this, arguments);\n    };\n\n    CommentQuestion.prototype.editingContext = function() { return this._editingcontext; };\n\n    CommentQuestion.prototype.editingView = function() {\n        return this.editForm('\\\\teamevalquestion_comment\\\\forms\\\\edit_form',\n            $.param(this._editingcontext), {'locked': this._editinglocked});\n    };\n\n    CommentQuestion.prototype.save = function(ordinal) {\n        var form = this.container.find('form');\n        Editor.saveAll(form);\n\n        var data = Formparse.serializeObject(form);\n\n        var savePromise = this.saveForm(form, ordinal);\n        var strPromise = Strings.get_strings([\n                {key: 'exampleuser', component: 'local_teameval'},\n                {key: 'yourself', component: 'local_teameval'}\n            ]);\n\n        return $.when(savePromise, strPromise).then( function(result, str) {\n            var demoUsers = [{ userid: 0, name: str[0] }];\n            if (this._self) {\n                demoUsers.unshift({userid: -1, name: str[1], self: true});\n            }\n\n            this._submissioncontext = $.extend({}, Formparse.serializeObject(form, { fixCheckboxes: true }), {\n                users: demoUsers,\n            });\n            this._submissioncontext.description = data.description.text;\n\n            this._editingcontext = data;\n\n            return result;\n        }.bind(this));\n    };\n\n    CommentQuestion.prototype.validateData = function(form) {\n\n        var deferred = $.Deferred();\n\n        var data = function(v) { return $(form).find('[name=\"'+v+'\"]').val(); };\n\n        if ((data('title').trim().length === 0) && (data('description').trim().length === 0)) {\n            Strings.get_string('titleordescription', 'teamevalquestion_comment').done(function(str) {\n                deferred.reject({invalid: true, errors: { title: str, description: str} });\n            });\n        } else {\n            deferred.resolve();\n        }\n\n        return deferred.promise();\n    };\n\n    CommentQuestion.prototype.submit = function(call) {\n        var comments = [];\n        this.container.find('.comments textarea').each(function() {\n            var toUser = $(this).data('touser');\n            var m = {};\n            m.touser = toUser;\n            m.comment = $(this).val();\n            comments.push(m);\n        });\n\n        call({\n            methodname: 'teamevalquestion_comment_submit_response',\n            args: {\n                teamevalid: this.teameval,\n                id: this.questionID,\n                comments: comments\n            }\n        });\n\n        var incomplete = false;\n        if (!this._submissioncontext.optional) {\n            incomplete = this.checkComplete();\n        }\n\n        return !incomplete;\n    };\n\n    CommentQuestion.prototype.reset = function() {\n        this.container.find('.comments textarea').val('');\n        return $.Deferred().resolve().promise();\n    };\n\n    CommentQuestion.prototype.checkComplete = function() {\n        var incomplete = this.container.find('textarea').filter(function() {\n            return $(this).val().trim().length === 0;\n        });\n\n        if (incomplete.length > 0) {\n            this.container.parent().addClass('incomplete');\n        } else {\n            this.container.parent().removeClass('incomplete');\n        }\n\n        return incomplete.length > 0;\n    };\n\n    return CommentQuestion;\n\n});"],"file":"question.min.js"}