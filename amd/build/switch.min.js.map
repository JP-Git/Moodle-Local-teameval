{"version":3,"sources":["../src/switch.js"],"names":["define","$","overrides","breakOverrides","el","overriddenBy","data","trigger","overrideSubswitches","state","id","attr","i","o","length","init","tristate","hasClass","override","push","html","append","addClass","on","evt","newState","target","offsetX","pageX","offset","left","width","find","show","hide","source","oldState","removeClass","resolveStates","changed","each","k","os","sw","window","console","log"],"mappings":"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","sourcesContent":["define(['jquery'], function($) {\n\n    // switch id: [switch jQueries]\n    var overrides = {};\n\n    function breakOverrides(el) {\n        var overriddenBy = $('#'+el.data('override'));\n        if(overriddenBy) {\n            // reset\n            // el.data('overridden-by', null);\n            overriddenBy.trigger('setState', [null, 'break']);\n        }\n    }\n\n    function overrideSubswitches(el, state) {\n        var id = el.attr('id');\n        if (overrides[id] !== undefined) {\n            for (var i = 0; i < overrides[id].length; i++) {\n                var o = overrides[id][i];\n                o.trigger('setState', [state, 'override']);\n                // o.data('overridden-by', el);\n            }\n        }\n    }\n\n    return {\n        init: function(o) {\n\n            o = $(o);\n\n            var tristate = $(o).hasClass(\"tristate\");\n\n            var override = o.data('override');\n            if (override !== undefined) {\n                if (overrides[override] === undefined) {\n                    overrides[override] = [];\n                }\n                overrides[override].push(o);\n            }\n\n            o.html(\n'<div class=\"toggle\">' +\n'<svg class=\"loading-indicator\" xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 1 1\">' +\n'    <g fill=\"black\">' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" />' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-45 0.5 0.5)\"  style=\"opacity: 1.0\"/>' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-90 0.5 0.5)\"  style=\"opacity: 0.9\"/>' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-135 0.5 0.5)\" style=\"opacity: 0.8\" />' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-180 0.5 0.5)\" style=\"opacity: 0.7\" />' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-225 0.5 0.5)\" style=\"opacity: 0.6\" />' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-270 0.5 0.5)\" style=\"opacity: 0.5\" />' +\n'       <rect x=\"0.45\" y=\"0\" width=\"0.1\" height=\"0.37\" rx=\"0.05\" ry=\"0.05\" ' +\n'           transform=\"rotate(-315 0.5 0.5)\" style=\"opacity: 0.4\" />' +\n'       <animateTransform attributeName=\"transform\" attributeType=\"XML\" ' +\n'           type=\"rotate\" from=\"0 0.5 0.5\" to=\"360 0.5 0.5\" dur=\"1.5s\" repeatCount=\"indefinite\"/>' +\n'    </g>' +\n'</svg>' +\n'</div>');\n\n            if (tristate) {\n                o.append('<svg class=\"reject\" height=\"8\" viewBox=\"0 0 10 10\"><path d=\"M 1 1 L 8 8 M 1 8 L 8 1\" /></svg>');\n                o.append('<svg class=\"check\" viewBox=\"0 0 10 10\"><path d=\"M 1 6 L 4 8 L 8 1\" fill=\"none\" /></svg>');\n            }\n\n            var state = o.data('state');\n\n            if (state) {\n                o.addClass(state);\n            }\n\n            o.attr({\n                'aria-role' : 'checkbox',\n                'aria-checked': o.hasClass('checked') ? 'true' : 'false'\n            });\n\n            o.on('click', function(evt) {\n\n                var newState;\n\n                if (tristate) {\n\n                    if (o.hasClass('rejected') || o.hasClass('checked')) {\n                        // always go back to neutral\n                        o.trigger('setState', [null, 'user']);\n\n                    } else {\n\n                        var target = $(evt.target);\n\n                        if (target.hasClass('toggle')) {\n                            //do nothing. clicking the toggle has no effect.\n                            return;\n                        }\n\n                        var offsetX = evt.pageX - o.offset().left;\n\n\n                        if (offsetX < o.width() / 2) {\n                            newState = 'rejected';\n                        } else {\n                            newState = 'checked';\n                        }\n\n                        o.trigger('setState', [newState, 'user']);\n\n                    }\n\n                } else {\n                    // switch always toggles\n\n                    newState = o.hasClass('checked') ? null : 'checked';\n                    o.trigger('setState', [newState, 'user']);\n\n                }\n\n            });\n\n            o.on('showLoading', function() {\n                o.find('.loading-indicator').show();\n            });\n\n            o.on('hideLoading', function() {\n                o.find('.loading-indicator').hide();\n            });\n\n\n            o.on('setState', function (evt, newState, source) {\n\n                var oldState = o.data('state');\n\n                o.removeClass('rejected');\n                o.removeClass('checked');\n\n                if (newState) {\n                    o.addClass(newState);\n                    o.attr('aria-checked', newState == 'checked' ? 'true' : 'false');\n                } else {\n                    o.attr('aria-checked', 'mixed');\n\n                }\n\n                o.data('state', newState);\n\n                if (source != 'auto') {\n                    if (oldState != newState) {\n                        o.trigger('changed');\n                    }\n                }\n\n                if (source == 'user') {\n                    breakOverrides(o);\n                    overrideSubswitches(o, newState);\n                }\n\n                if (source == 'break') {\n                    breakOverrides(o);\n                }\n\n                if (source == 'override') {\n                    overrideSubswitches(o, newState);\n                }\n\n\n            });\n\n\n\n        },\n\n        resolveStates: function() {\n\n            // This function is designed to be called after all switches have been initialised\n\n            var changed = false;\n\n            $.each(overrides, function(k, os) {\n\n                var state = os[0].data('state');\n                for (var i = os.length - 1; i >= 0; i--) {\n                    var o = os[i];\n                    if(o.data('state') != state) {\n                        state = null;\n                    }\n                }\n\n                var sw = $('#'+k);\n                if (sw.length === 0) {\n                    delete overrides[k];\n                    return;\n                }\n\n                var oldState = sw.data('state');\n                if(oldState != state) {\n                    sw.trigger('setState', [state, 'auto']);\n                    var newState = sw.data('state');\n                    if (newState != state) {\n                        window.console.log(\"Update state failed!\");\n                        return false;\n                    }\n                    changed = true;\n                }\n\n            });\n\n            if(changed) {\n                // repeat until stable\n                this.resolveStates();\n            }\n\n        }\n\n\n    };\n\n});\n"],"file":"switch.min.js"}